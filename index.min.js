var Discord=require("discord.js"),fs=require("fs"),config,bot=new Discord.Client,modules={};bot.on("ready",function(){bot.user.setGame("@Radio Help")});
bot.on("message",function(b){if(!b.author.bot){var c=b.content.toLowerCase().split(" "),f=c[1];c.splice(0,2);console.log("[COMMAND] ("+(new Date).getHours()+": "+(new Date).getMinutes()+") "+b.author.username+"#"+b.author.discriminator+": "+b.content);for(var e in modules){var a=!1;if(modules.hasOwnProperty(e)){for(var d=0;d<e.commands.length;d++)if(f===e.commands[d].name||0<=e.commands[d].aliases.indexOf(f)){a=e.commands[d];break}if(a)break}a?!a.owner||0<=config.ownerID.indexOf(b.auther.id)?"text"===
b.channel.type||"text"!==b.channel.type&&a.dm?a.func({msg:b,bot:bot,library:"./library/"+e.name.toLowerCase().replace(/\s+/g,""),modules:modules,args:c}):(b.channel.send("Sorry that command cannot be used in this channel").then(function(a){a["delete"](1E4)}),b["delete"](1E4)):(b.channel.send("You do not have permission for that command.").then(function(a){a["delete"](1E4)}),b["delete"](1E4)):(b.channel.send("That command does not exist.").then(function(a){a["delete"](1E4)}),b["delete"](1E4))}}});
function loadModules(b){var c=0;b.forEach(function(b,e){if(fs.statSync("modules/"+b).isFile())try{modules[b.substring(0,b.indexOf(".js"))]=require("./modules/"+b),modules[b.substring(0,b.indexOf(".js"))].commands.forEach(function(a){a.aliases=void 0===a.aliases?[]:a.aliases;a.help=void 0===a.help?"No help info was provided for this command":a.help;a.usage=void 0===a.usage?"No usage info was provided with this command":a.usage;a.dm=void 0===a.dm?!1:a.dm;a.owner=void 0===a.owner?!1:a.owner}),console.log("[INFO] Loaded module "+
b),c++}catch(a){console.log("\u001b[31m[ERROR] Could not load module "+b+": "+a.message+"\u001b[0m")}});return c}
function initialise(){console.log("[INFO] Starting Bot ...");fs.readdir("./",function(b,c){if(b)return console.error(b);if(void 0===c||1>c.length)return console.error("[ERROR] No files are available including this one. (This error shouldn't appear but if it does you've done something wrong)");for(var f=!1,e=!1,a=!1,d=0;d<c.length;d++){var g=fs.statSync(c[d]);"modules"===c[d]&&g.isDirectory()?f=!0:"library"===c[d]&&g.isDirectory()?e=!0:"config.js"===c[d]&&g.isFile()&&(a=!0)}f||(console.log("[INFO] Modules folder not found, creating one now."),
fs.mkdirSync("modules"));e||(console.log("[INFO] Library folder not found, creating one now."),fs.mkdirSync("library"));a||(console.log("[INFO] Config file not found, creating one now."),fs.writeFileSync("./config.js",fs.readFileSync("./example_config.js")));console.log("[INFO] Loading config file ...");config=require("./config.js");console.log("[INFO] Loading Modules ...");fs.readdir("modules",function(a,c){if(a)throw a;var d=loadModules(c);console.log("[INFO] Loaded ["+d+"/"+c.length+"] modules.");
console.log(modules);0<d?(console.log("[INFO] Logging in ..."),bot.login(config.botToken).then(function(){console.log("[INFO] Bot successfully logged in.")})["catch"](function(a){console.error("\u001b[31m[ERROR] Issue Logging in: "+b+"\u001b[0m")})):console.error("\u001b[31m[ERROR] No modules were loaded\u001b[0m")})})}initialise();
